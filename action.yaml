name: 'aws-authenticate'
description: ''
inputs:
  vault_addr:
    description: ''
    required: true
  vault_aws_role:
    description: ''
    required: true
  aws_role:
    description: ''
    required: true
runs:
  using: 'composite'
  steps:
    - name: Install Vault
      uses: innovationnorway/setup-vault@v1
    - name: Generate AWS credentials
      shell: bash
      run: |
        vault read -address=${{ inputs.vault_addr }} aws/sts/${{ inputs.vault_role }} --format=json > creds.json
        export AWS_ACCESS_KEY_ID=$(jq -r '.data.access_key' creds.json)
        export AWS_SECRET_ACCESS_KEY=$(jq -r '.data.secret_key' creds.json)
        export AWS_SESSION_TOKEN=$(jq -r '.data.security_token' creds.json)
        export AWS_ROLE_ARN=${{ inputs.aws_role }}